(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const g of s.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();let o,w=null;function I(){return(w===null||w.byteLength===0)&&(w=new Uint8Array(o.memory.buffer)),w}let d=0;function m(e,t){const r=t(e.length*1,1)>>>0;return I().set(e,r/1),d=e.length,r}function y(e,t){return e=e>>>0,I().subarray(e/1,e/1+t)}function R(e,t,r){const i=m(e,o.__wbindgen_malloc),n=d,s=o.resize(i,n,t,r);var g=y(s[0],s[1]).slice();return o.__wbindgen_free(s[0],s[1]*1,1),g}function E(e){const t=m(e,o.__wbindgen_malloc),r=d,i=o.grayscale(t,r);var n=y(i[0],i[1]).slice();return o.__wbindgen_free(i[0],i[1]*1,1),n}function U(e,t){const r=m(e,o.__wbindgen_malloc),i=d,n=o.blur(r,i,t);var s=y(n[0],n[1]).slice();return o.__wbindgen_free(n[0],n[1]*1,1),s}function A(e){const t=m(e,o.__wbindgen_malloc),r=d,i=o.invert(t,r);var n=y(i[0],i[1]).slice();return o.__wbindgen_free(i[0],i[1]*1,1),n}function B(e,t){const r=m(e,o.__wbindgen_malloc),i=d,n=o.brighten(r,i,t);var s=y(n[0],n[1]).slice();return o.__wbindgen_free(n[0],n[1]*1,1),s}function O(e){const t=m(e,o.__wbindgen_malloc),r=d,i=o.flip_horizontal(t,r);var n=y(i[0],i[1]).slice();return o.__wbindgen_free(i[0],i[1]*1,1),n}function k(e){const t=m(e,o.__wbindgen_malloc),r=d,i=o.rotate90(t,r);var n=y(i[0],i[1]).slice();return o.__wbindgen_free(i[0],i[1]*1,1),n}async function W(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function S(){const e={};return e.wbg={},e.wbg.__wbindgen_init_externref_table=function(){const t=o.__wbindgen_export_0,r=t.grow(4);t.set(0,void 0),t.set(r+0,void 0),t.set(r+1,null),t.set(r+2,!0),t.set(r+3,!1)},e}function x(e,t){return o=e.exports,L.__wbindgen_wasm_module=t,w=null,o.__wbindgen_start(),o}async function L(e){if(o!==void 0)return o;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/assets/img_processor_bg-DI6vp1eK.wasm",import.meta.url));const t=S();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:i}=await W(await e,t);return x(r,i)}async function N(){const e=await fetch("./img_processor/pkg/img_processor_bg.wasm");await L(await e.arrayBuffer());const t=document.getElementById("imageInput"),r=document.getElementById("preview"),i=document.getElementById("applyFilter"),n=document.getElementById("filterSelect"),s=document.getElementById("resultCanvas"),g=s.getContext("2d");let l=null,p=null,_;const v=window.indexedDB.open("ImageDatabase",1);v.onerror=function(c){console.error("IndexedDB error:",c)},v.onupgradeneeded=function(c){_=c.target.result,_.createObjectStore("images",{autoIncrement:!0})},v.onsuccess=function(c){_=c.target.result},t.addEventListener("change",async c=>{const a=c.target.files[0];if(a){const f=URL.createObjectURL(a);r.src=f,r.style.display="block";const u=await a.arrayBuffer();l=new Uint8Array(u)}}),i.addEventListener("click",async()=>{if(!l){alert("Seleccione una imagen primero.");return}const c=n.value;let a;try{switch(c){case"resize":a=R(l,200,200);break;case"grayscale":a=E(l);break;case"blur":a=U(l,5);break;case"invert":a=A(l);break;case"brighten":a=B(l,30);break;case"flip_horizontal":a=O(l);break;case"rotate90":a=k(l);break;default:alert("Seleccione un filtro válido.");return}const f=new Blob([a],{type:"image/png"});p=f;const u=URL.createObjectURL(f),b=new Image;b.onload=function(){s.width=b.width,s.height=b.height,g.drawImage(b,0,0),URL.revokeObjectURL(u)},b.src=u,Notification.permission==="granted"?new Notification("Imagen procesada",{body:"El filtro se aplicó con éxito."}):Notification.permission!=="denied"&&Notification.requestPermission().then(h=>{h==="granted"&&new Notification("Imagen procesada",{body:"El filtro se aplicó con éxito."})})}catch(f){console.error(f)}}),document.getElementById("saveImage").addEventListener("click",()=>{if(!p){alert("No hay imagen procesada para guardar.");return}const f=_.transaction(["images"],"readwrite").objectStore("images").add(p);f.onsuccess=function(){alert("Imagen guardada en IndexedDB.")},f.onerror=function(h){console.error("Error al guardar:",h)};const u=document.createElement("a"),b=URL.createObjectURL(p);u.href=b,u.download="processed_image.png",u.click()})}"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(e){for(let t of e)t.unregister().then(function(r){r&&console.log("Service worker desregistrado correctamente")})});"caches"in window&&caches.keys().then(function(e){for(let t of e)caches.delete(t)});N();
